<!DOCTYPE html>
<html>
<head>
    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Add Socket.IO JavaScript client -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>

    <style>
        .hidden { display: none; }
        #cmdGuideTable, #cmdGuideTable th, #cmdGuideTable td {
            border: 1px solid black;
            border-collapse: collapse;
        }
        #cmdGuideTable {
            width: 100%;
            margin-bottom: 20px;
        }
        #cmdGuideTable th, #cmdGuideTable td {
            padding: 5px;
            text-align: left;
        }
    </style>
</head>
<body>
    <!-- CMD Guide Table -->
    <!-- ... (same as before) ... -->

    <form id="promptForm">
        <label for="CMD">CMD:</label>
        <input type="text" id="CMD" name="CMD">
        
        <label for="tag">Tag:</label>
        <input type="text" id="tag" name="tag">
        
        <label for="SPINS">SPINS:</label>
        <input type="text" id="SPINS" name="SPINS">
        
        <input type="button" value="Submit" onclick="sendPromptData()">
    </form>

    <div id="loadingIndicator" style="display: none;">Loading...</div>
    <div id="japaneseStory"></div>
    <div id="englishSummary"></div>
    <ul id="difficultWords"></ul>
    <div id="imageContainer"></div>

    <script>
        var socket = io();

        function sendPromptData() {
            var CMD = $("#CMD").val();
            var tag = $("#tag").val();
            var SPINS = $("#SPINS").val();
            socket.emit('send_prompt', {CMD: CMD, tag: tag, SPINS: SPINS});
        }

        // Handle streamed data
        socket.on('streamed_response', function(data) {
            var content = JSON.parse(data.data); // Assuming data is JSON-formatted
            // Display content as it arrives
            if (content.japanese_story) {
                $("#japaneseStory").append("<p>" + content.japanese_story + "</p>");
            }
            if (content.english_summary) {
                $("#englishSummary").append("<p>" + content.english_summary + "</p>");
            }
            if (content.difficult_words) {
                content.difficult_words.forEach(function(word) {
                    $("#difficultWords").append("<li>" + word.japanese + " - " + word.english + "</li>");
                });
            }
        });

        // Existing 'prompt_response' event handler
        socket.on('prompt_response', function(data) {
            if (data.image_url) {
                var imageHTML = `<img src="${data.image_url}" alt="Generated Image">`;
                $("#imageContainer").html(imageHTML);
            }
        });
    </script>
</body>
</html>
