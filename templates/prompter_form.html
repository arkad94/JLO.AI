<!-- templates/create_prompt.html -->

<head>
    <!-- Make sure to include jQuery if it's not already included -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Add Socket.IO JavaScript client -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
</head>

<body>
    <form id="promptForm">
        <label for="CMD">CMD:</label>
        <input type="text" id="CMD" name="CMD">
        
        <label for="tag">Tag:</label>
        <input type="text" id="tag" name="tag">
        
        <label for="SPINS">SPINS:</label>
        <input type="text" id="SPINS" name="SPINS">
        
        <input type="button" value="Submit" onclick="sendPromptData()">
    </form>

    <!-- Divs for displaying stories -->
    <div id="japaneseStory"></div>
    <div id="englishSummary"></div>

    <div id="results"></div>

    <script>
        var socket = io();
    
        function sendPromptData() {
            var CMD = $("#CMD").val();
            var tag = $("#tag").val();
            var SPINS = $("#SPINS").val();
            $("#japaneseStory").html(""); // Clear previous Japanese story
            $("#englishSummary").html(""); // Clear previous English summary
            socket.emit('send_prompt', {CMD: CMD, tag: tag, SPINS: SPINS});
        }

        // Function to check if a string contains Japanese characters
        function containsJapanese(text) {
            return /[\u3000-\u303f\u3040-\u309f\u30a0-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff]/.test(text);
        }

        // Function to display Japanese story
        function displayJapaneseStory(content) {
            if (containsJapanese(content)) {
                $("#japaneseStory").append(content);
            }
        }

        // Function to display English summary
        function displayEnglishSummary(content) {
            if (!containsJapanese(content)) {
                $("#englishSummary").append(content);
            }
        }

        socket.on('text_chunk', function(data) {
            var content = data.chunk;
            displayJapaneseStory(content);
            displayEnglishSummary(content);
        });

        socket.on('update', function(data) {
            $("#results").append("<p>" + data.message + "</p>"); // Append update messages
        });

        socket.on('stream_end', function(data) {
            $("#results").append("<p>" + data.message + "</p>"); // Append the end message
        });
    </script>
</body>

    