<!-- templates/create_prompt.html -->

<head>
    <!-- Include jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
    <form id="promptForm">
        <label for="CMD">CMD:</label>
        <input type="text" id="CMD" name="CMD">
        
        <label for="tag">Tag:</label>
        <input type="text" id="tag" name="tag">
        
        <label for="SPINS">SPINS:</label>
        <input type="text" id="SPINS" name="SPINS">
        
        <input type="button" value="Submit" onclick="getPromptResults()">
    </form>

    <div id="results"></div>

    <script>
        function getPromptResults() {
            var cmd = $("#CMD").val();
            var tag = $("#tag").val();
            var spins = $("#SPINS").val();
        
            $.ajax({
                url: '/get_prompt_results',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 'CMD': cmd, 'tag': tag, 'SPINS': spins }),
                success: function(taskResponse) {
                    // Start polling for task completion
                    pollTaskStatus(taskResponse.task_id);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }
        
        function pollTaskStatus(taskId) {
            $.ajax({
                url: '/check_task_status/' + taskId,
                type: 'GET',
                success: function(taskStatusResponse) {
                    if (taskStatusResponse.status === 'completed') {
                        displayResults(taskStatusResponse);
                    } else {
                        // Repeat polling after a delay
                        setTimeout(function() {
                            pollTaskStatus(taskId);
                        }, 2000); // Poll every 2 seconds
                    }
                },
                error: function(error) {
                    console.log(error);
                }
            });
        }
        
        function displayResults(response) {
            // Update the DOM with response data
            var resultHtml = "<h1>Response from OpenAI</h1><p>" + response.text_response + "</p>";
            resultHtml += "<h2>Difficult Words</h2><ul>";
            response.difficult_words.forEach(function(word) {
                resultHtml += "<li>" + word[0] + " - " + word[1] + "</li>";
            });
            resultHtml += "</ul>";
            $("#results").html(resultHtml);
        }
    </script>
</body>
