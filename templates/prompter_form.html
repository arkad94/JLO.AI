<!DOCTYPE html>
<html>
<head>
    <!-- ... Other head elements ... -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>

    <!-- ... Styles ... -->
</head>
<body>
    <!-- ... HTML content ... -->

    <script>
        var socket = io();
    
        function sendPromptData() {
            var CMD = $("#CMD").val();
            var tag = $("#tag").val();
            var SPINS = $("#SPINS").val();
            socket.emit('send_prompt', {CMD: CMD, tag: tag, SPINS: SPINS});
        }
    
        // Handle streamed data
        socket.on('streamed_response', function(data) {
            // Process each received chunk of data
            try {
                var content = data.data; // Directly using the data without JSON parsing

                // Append the content directly to the DOM elements
                $("#japaneseStory").append(content.japanese_story ? "<p>" + content.japanese_story + "</p>" : "");
                $("#englishSummary").append(content.english_summary ? "<p>" + content.english_summary + "</p>" : "");
                if (content.difficult_words) {
                    content.difficult_words.forEach(function(word) {
                        $("#difficultWords").append("<li>" + word.japanese + " - " + word.english + "</li>");
                    });
                }
            } catch (e) {
                console.error("Error handling streamed response:", e);
            }
        })
    
        // Existing 'prompt_response' event handler
        socket.on('prompt_response', function(data) {
            if (data.image_url) {
                var imageHTML = `<img src="${data.image_url}" alt="Generated Image">`;
                $("#imageContainer").html(imageHTML);
            }
        });
    </script>
    
</body>
</html>



